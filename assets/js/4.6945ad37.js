(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{172:function(s,t,n){s.exports=n.p+"assets/img/self_dep.fd7eaed3.png"},173:function(s,t,n){s.exports=n.p+"assets/img/watch.2beb750f.png"},174:function(s,t,n){s.exports=n.p+"assets/img/vue_watch.5de7af21.png"},183:function(s,t,n){"use strict";n.r(t);var a=[function(){var s=this.$createElement,t=this._self._c||s;return t("h1",{attrs:{id:"响应式数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#响应式数据","aria-hidden":"true"}},[this._v("#")]),this._v(" 响应式数据")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"需要实现的目标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#需要实现的目标","aria-hidden":"true"}},[this._v("#")]),this._v(" 需要实现的目标")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" expense "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  duration"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("2")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("    "),n("span",{attrs:{class:"token comment"}},[s._v("// 停车时长")]),s._v("\n  day_money"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("100")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// 一天多少钱")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" total  "),n("span",{attrs:{class:"token comment"}},[s._v("// 总金额")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("calculate")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  total "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("duration "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v(" expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("day_money\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 实现一个watch，就可以像原生input change一样，观察到expense的变化")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 我们这里是执行calculate")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// calculate只是一个callback: 可以是 重新计算、请求接口数据、重新渲染等等")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("watch")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" calculate"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nexpense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("duration "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("5")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// 自动执行callback， total = 500")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"获取变化通知"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取变化通知","aria-hidden":"true"}},[this._v("#")]),this._v(" 获取变化通知")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-ruby line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ruby"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("A")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("def")]),s._v(" a\n    "),n("span",{attrs:{class:"token variable"}},[s._v("@a")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("def")]),s._v(" a"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    p "),n("span",{attrs:{class:"token string"}},[s._v("'大家请注意：我发生变化了...'")]),s._v("\n    "),n("span",{attrs:{class:"token variable"}},[s._v("@a")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" value\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\ndemo "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token constant"}},[s._v("A")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v("\n"),n("span",{attrs:{class:"token class-name"}},[s._v("demo"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("a")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v('# "大家请注意：我发生变化了..."')]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("# => 100")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" expense "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  duration"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("2")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("    "),n("span",{attrs:{class:"token comment"}},[s._v("// 停车时长")]),s._v("\n  day_money"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("100")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// 一天多少钱")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" total "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("null")]),s._v("  "),n("span",{attrs:{class:"token comment"}},[s._v("// 总金额")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 总金额的计算依赖于 duration * day_money")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("calculate")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  total "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("duration "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v(" expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("day_money\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" expense"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token string"}},[s._v("'duration'")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nObject"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("defineProperty")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'duration'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  enumerable"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token boolean"}},[s._v("true")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  configurable"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token boolean"}},[s._v("true")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("get")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("log")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'duration属性被访问到了！'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" value\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("set")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("log")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'duration属性被修改了，新值为:'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("',旧值为：'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" value"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" newValue\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nexpense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("duration\n"),n("span",{attrs:{class:"token comment"}},[s._v("// output")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// duration属性被访问到了！")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 2")]),s._v("\n\nexpense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("duration "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// duration属性被修改了，新值为: 5 ,旧值为： 2")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 5")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("这里的setter里 "),t("code",[this._v("console.log")]),this._v(" ==> 相当于一个callback。\n实现watch功能：")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" expense "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  duration"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("2")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("    "),n("span",{attrs:{class:"token comment"}},[s._v("// 停车时长")]),s._v("\n  day_money"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("100")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// 一天多少钱")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("watch")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" callback"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" obj"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  Object"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("defineProperty")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    enumerable"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token boolean"}},[s._v("true")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    configurable"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token boolean"}},[s._v("true")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("get")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" value\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("set")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue "),n("span",{attrs:{class:"token operator"}},[s._v("===")]),s._v(" value"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" oldValue "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" value\n        value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" newValue\n        "),n("span",{attrs:{class:"token function"}},[s._v("callback")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{attrs:{class:"token comment"}},[s._v("// setter 中触发回调函数，并将新值与旧值作为参数传入")]),s._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token function"}},[s._v("watch")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'duration'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("log")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token template-string"}},[n("span",{attrs:{class:"token string"}},[s._v("`duration属性被修改了，新值为：")]),n("span",{attrs:{class:"token interpolation"}},[n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("newValue"),n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),n("span",{attrs:{class:"token string"}},[s._v("，旧值为：")]),n("span",{attrs:{class:"token interpolation"}},[n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("oldValue"),n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),n("span",{attrs:{class:"token string"}},[s._v("`")])]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nexpense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("duration "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("99")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// duration属性被修改了，新值为：99，旧值为：2")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 99")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"通知变化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通知变化","aria-hidden":"true"}},[this._v("#")]),this._v(" 通知变化")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Dep")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token function"}},[s._v("constructor")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token comment"}},[s._v("// 订阅者列表")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("subs "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 添加订阅")]),s._v("\n  "),n("span",{attrs:{class:"token function"}},[s._v("addSub")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sub"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("subs"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("push")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sub"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 触发订阅")]),s._v("\n  "),n("span",{attrs:{class:"token function"}},[s._v("notify")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("subs"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("forEach")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sub "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      sub"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("update")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("基本的套路。这里我们注意一下，每个订阅者都要能够响应"),t("code",[this._v("update")]),this._v("方法，这里就有一定局限，得是对象才行。如果此时订阅者是个匿名函数，就处理不了。所以这里可以抽出个中间层出来 ----\x3e 叫做 Watcher。")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("// Watcher类，每个 Watcher 为一个订阅源")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Watcher")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token function"}},[s._v("constructor")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("callback"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("callback "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" callback\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{attrs:{class:"token function"}},[s._v("update")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token comment"}},[s._v("// 被触发后执行回调")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("callback")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" dep "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Dep")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" sub1 "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Watcher")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("log")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'第一条......'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" sub2 "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Watcher")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("log")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'第二条......'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 一个watcher 相当于 一个sub")]),s._v("\ndep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("addSub")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sub1"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("addSub")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sub2"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("notify")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("2")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" expense "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  duration"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("2")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("    "),n("span",{attrs:{class:"token comment"}},[s._v("// 停车时长")]),s._v("\n  day_money"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("100")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// 一天多少钱")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" total "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("null")]),s._v("  "),n("span",{attrs:{class:"token comment"}},[s._v("// 总金额")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 总金额的计算依赖于 duration * day_money")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("calculate")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  total "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("duration "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v(" expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("day_money\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Dep")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token function"}},[s._v("constructor")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token comment"}},[s._v("// 订阅者列表")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("subs "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 添加订阅")]),s._v("\n  "),n("span",{attrs:{class:"token function"}},[s._v("addSub")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sub"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("subs"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("push")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sub"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 触发订阅")]),s._v("\n  "),n("span",{attrs:{class:"token function"}},[s._v("notify")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("subs"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("forEach")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sub "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      sub"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("update")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("// Watcher类，每个 Watcher 为一个订阅源")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Watcher")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token function"}},[s._v("constructor")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("callback"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("callback "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" callback\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{attrs:{class:"token function"}},[s._v("update")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token comment"}},[s._v("// 被触发后执行回调")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("callback")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 使一个对象响应化")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 遍历对象所有key，全部设置属性描述")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("observify")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  Object"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("keys")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("forEach")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("defineReactive")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("defineReactive")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" obj"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n  Object"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("defineProperty")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    enumerable"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token boolean"}},[s._v("true")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    configurable"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token boolean"}},[s._v("true")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("get")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" value\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("set")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" value"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" oldValue "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" value\n        value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" newValue\n        globalDep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("notify")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),n("span",{attrs:{class:"token comment"}},[s._v("// <========= 变动时触发通知")]),s._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" globalDep "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Dep")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" sub1 "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Watcher")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("log")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token template-string"}},[n("span",{attrs:{class:"token string"}},[s._v("`属性被修改了，新值为：")]),n("span",{attrs:{class:"token interpolation"}},[n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("newValue"),n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),n("span",{attrs:{class:"token string"}},[s._v("，旧值为：")]),n("span",{attrs:{class:"token interpolation"}},[n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("oldValue"),n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),n("span",{attrs:{class:"token string"}},[s._v("`")])]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nglobalDep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("addSub")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sub1"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 让对象响应化")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("observify")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nexpense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("duration "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("20")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 属性被修改了，新值为：20，旧值为：2")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 20")]),s._v("\n\nexpense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("day_money "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("555")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 属性被修改了，新值为：555，旧值为：100")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 555")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"依赖收集"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#依赖收集","aria-hidden":"true"}},[this._v("#")]),this._v(" 依赖收集")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("也许可以:")]),this._v(" "),t("ul",[t("li",[this._v("谁依赖(使用)了该属性，谁就是订阅者。")]),this._v(" "),t("li",[this._v("在使用属性值时，会触发getter，在那里进行订阅。")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("img",{attrs:{src:n(172),alt:"self_dep"}})])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("defineReactive")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" dep "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Dep")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// <========= 为每个键都创建一个 dep")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" obj"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 由于闭包，属性时刻可以访问到以上变量")]),s._v("\n  Object"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("defineProperty")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    enumerable"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token boolean"}},[s._v("true")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    configurable"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token boolean"}},[s._v("true")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("get")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      dep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("depend")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// <========= 进行订阅 ????")]),s._v("\n      "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" value\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("set")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" value"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" oldValue "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" value\n        value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" newValue\n        dep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("notify")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),n("span",{attrs:{class:"token comment"}},[s._v("// <========= 变动时触发通知")]),s._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("sub1 = new Watch((newValue, oldValue) => {\n\ttotal = expense.duration * expense.day_money\n\trender\n})\n")])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br"),t("span",{staticClass:"line-number"},[this._v("2")]),t("br"),t("span",{staticClass:"line-number"},[this._v("3")]),t("br"),t("span",{staticClass:"line-number"},[this._v("4")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("blockquote",[t("p",[t("code",[this._v("dep.depend()")]),this._v(" 要如何将 sub1给添加进来订阅列表？？")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("比如： "),t("code",[this._v("<p>{ expense.duration * expense.day_money}</p>")]),this._v("\n模板引擎会被解释为：")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("init")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'<p>'")]),n("span",{attrs:{class:"token operator"}},[s._v("+")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("duration "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v(" expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("day_money"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token operator"}},[s._v("+")]),n("span",{attrs:{class:"token string"}},[s._v("'</p>'")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("// 用来记录当前是哪个watcher, 共用。")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 将当前watcher放入当前属性的订阅列表中")]),s._v("\nDep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("null")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("img",{attrs:{src:n(173),alt:"watch"}})])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("// 使一个对象响应化")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 遍历对象所有key，全部设置属性描述")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("observify")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  Object"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("keys")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("forEach")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("defineReactive")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("defineReactive")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" dep "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Dep")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// <========= 为每个键都创建一个 dep")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" obj"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 由于闭包，属性时刻可以访问到以上变量")]),s._v("\n  Object"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("defineProperty")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    enumerable"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token boolean"}},[s._v("true")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    configurable"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token boolean"}},[s._v("true")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("get")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{attrs:{class:"token comment"}},[s._v("// 相当于一个状态值。用来记录当前线程正在处理哪个watcher,如果存在，将其加入到订阅列表中")]),s._v("\n      "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Dep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        dep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("depend")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// <========= 进行订阅")]),s._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n      "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" value\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("set")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue "),n("span",{attrs:{class:"token operator"}},[s._v("==")]),s._v(" value"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" oldValue "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" value\n        value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" newValue\n        dep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("notify")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),n("span",{attrs:{class:"token comment"}},[s._v("// <========= 变动时触发通知")]),s._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" uid "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Dep")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token function"}},[s._v("constructor")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token comment"}},[s._v("// 为每个 dep 标记一个 uid")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" uid"),n("span",{attrs:{class:"token operator"}},[s._v("++")]),s._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[s._v("// 订阅者列表")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("subs "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 添加订阅")]),s._v("\n  "),n("span",{attrs:{class:"token function"}},[s._v("addSub")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sub"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("subs"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("push")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sub"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 触发订阅")]),s._v("\n  "),n("span",{attrs:{class:"token function"}},[s._v("notify")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("subs"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("forEach")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sub "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      sub"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("update")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{attrs:{class:"token function"}},[s._v("depend")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token comment"}},[s._v("// 这里的做法是 将当前的dep传出去。")]),s._v("\n    "),n("span",{attrs:{class:"token comment"}},[s._v("// 而不是将watcher传进来，这一点很重要")]),s._v("\n    "),n("span",{attrs:{class:"token comment"}},[s._v("// Dep.target 是个watcher")]),s._v("\n    Dep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target "),n("span",{attrs:{class:"token operator"}},[s._v("&&")]),s._v(" Dep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("addDep")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("// 用来记录当前是哪个watcher, 共用。")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 将当前watcher放入当前属性的订阅列表中")]),s._v("\nDep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("null")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("// Watcher类，每个 watcher 为一个订阅源")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Watcher")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token function"}},[s._v("constructor")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("expFn"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" callback"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("expFn "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" expFn\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("callback "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" callback\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("depIds "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Set")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// 标记当前 watcher 已经加入到了哪些 dep")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("subAndGetValue")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{attrs:{class:"token function"}},[s._v("update")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token comment"}},[s._v("// 被触发后执行回调")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("callback")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 这里才将watcher添加进dep")]),s._v("\n  "),n("span",{attrs:{class:"token function"}},[s._v("addDep")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dep"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token comment"}},[s._v("//防止重复订阅，防止在一个 dep 中订阅两次")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token operator"}},[s._v("!")]),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("depIds"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("has")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("depIds"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("add")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      dep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("addSub")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 执行依赖收集函数，订阅依赖！")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 只在expFn里面访问到属性，才会注册相关订阅")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 为什么要定义为expFn？这里执行函数的内容，比如 a + b.")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 访问 a 时，就会进入到 a的getter, 这个时候,")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 发现Dep.target有值 => 那么执行 dep.depend() => addDep()实现了真正的订阅")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 然后将Dep.target又置为空。")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// b的操作跟a类似。")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 所以在 expFn 访问过的属性（1个 或 多个），都实现了订阅。")]),s._v("\n  "),n("span",{attrs:{class:"token function"}},[s._v("subAndGetValue")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    Dep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" _value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("expFn"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("call")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    Dep"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("null")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" _value\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 封装成一个 Watcher")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("watch")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("expFn"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" callback"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Watcher")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("expFn"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" callback"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" expense "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  duration"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("2")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("    "),n("span",{attrs:{class:"token comment"}},[s._v("// 停车时长")]),s._v("\n  day_money"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("100")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// 一天多少钱")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" total "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("null")]),s._v("  "),n("span",{attrs:{class:"token comment"}},[s._v("// 总金额")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("calculate")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 这个地方访问了 duration 跟 day_money 的getter，但其实不会去注册订阅者，因为此时Dep.target为空")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("duration "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v(" expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("day_money\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 让对象响应化")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("observify")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" "),n("span",{attrs:{class:"token function-variable function"}},[s._v("expFn")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("duration "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" "),n("span",{attrs:{class:"token function-variable function"}},[s._v("callback")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" oldValue"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("log")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token template-string"}},[n("span",{attrs:{class:"token string"}},[s._v("`属性被修改了，新值为：")]),n("span",{attrs:{class:"token interpolation"}},[n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("newValue"),n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),n("span",{attrs:{class:"token string"}},[s._v("，旧值为：")]),n("span",{attrs:{class:"token interpolation"}},[n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("oldValue"),n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),n("span",{attrs:{class:"token string"}},[s._v("`")])]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  total "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("calculate")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("log")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token template-string"}},[n("span",{attrs:{class:"token string"}},[s._v("`total is ")]),n("span",{attrs:{class:"token interpolation"}},[n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("total"),n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),n("span",{attrs:{class:"token string"}},[s._v("`")])]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// 模拟重新渲染函数")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token function"}},[s._v("watch")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("expFn"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" callback"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nexpense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("duration "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("20")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("init")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'<p>'")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("duration "),n("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("  expense"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("day_money"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'</p>'")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token function"}},[s._v("init")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" expFn\n"),n("span",{attrs:{class:"token function"}},[s._v("render")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("渲染页面"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" callback\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("img",{attrs:{src:n(174),alt:"vue_watch"}})])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"文档"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文档","aria-hidden":"true"}},[this._v("#")]),this._v(" 文档")])}],e=n(0),r=Object(e.a)({},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"content"},[s._m(0),s._v(" "),s._m(1),s._v(" "),s._m(2),s._m(3),s._v(" "),n("p",[s._v("在A发生变化的时候，依赖A的B自动更新。\n那我们怎么知道数据发生变化？")]),s._v(" "),n("p",[s._v("在Ruby中，一个属性的getter 跟 setter可以这样定义：")]),s._v(" "),s._m(4),n("p",[s._v("在 js 中也有类似的东西，叫做属性描述。用来定义该属性的行为。")]),s._v(" "),s._m(5),s._m(6),s._v(" "),s._m(7),s._m(8),s._v(" "),n("p",[s._v("我们的目标是：A变化时，依赖于A的元素也跟着变化。\n使用发布/订阅的模式，有没有很熟悉~\n在 duration 发生变化时，发布”我已经更新了”的通知，所有订阅者各自根据注册的回调进行处理（打日志，重新渲染，重新计算等）")]),s._v(" "),s._m(9),s._m(10),s._v(" "),n("p",[s._v("Watcher 类有个 update 方法，注册订阅的时候，callback 对应到 update 即可。")]),s._v(" "),s._m(11),n("p",[s._v("将 两者接个起来：")]),s._v(" "),s._m(12),n("p",[s._v("现在，还要继续调整。\n因为现在这个globalDep是针对整个对象所有属性的。")]),s._v(" "),n("p",[s._v("比如 total 是 依赖 expense.duration 跟  expense.day_money，跟expense.created_at没有关系。\n所以我们要试着将Dep实例移到每个属性里面，也就是说，每个属性都有自己订阅列表。")]),s._v(" "),n("p",[s._v("那我们怎么知道属性有哪些订阅者？在哪里进行订阅？")]),s._v(" "),s._m(13),s._v(" "),n("p",[s._v("那我们怎么知道属性有哪些订阅者？在哪里进行订阅？")]),s._v(" "),s._m(14),s._v(" "),s._m(15),s._v(" "),s._m(16),n("p",[s._v("比如：total 依赖 expense.duration。 当expense.duration改变时，callback为”计算费用并重新渲染页面“，为该callback创建一个watcher作为订阅源。")]),s._v(" "),s._m(17),s._m(18),s._v(" "),n("p",[s._v("这里是没有办法把sub1传进来 defineProperty 来。因为observify是针对所有key一块处理的，没办法单独传一个sub1针对某个属性。")]),s._v(" "),n("p",[s._v("那该怎么做？？？？？？")]),s._v(" "),s._m(19),s._v(" "),s._m(20),n("p",[s._v("页面初始化的时候，init肯定会执行一次。这个时候所有的页面渲染需要的数据，都会被访问到。而那些无关的数据，就算它们发生改变，也不需要重新渲染。")]),s._v(" "),n("p",[s._v("在页面初始化时，在一个公共的地方存放当前watcher(callback就是更新页面处理), 当到依赖数据时，就将当前watcher放到对应的dep里面。这是一个很巧妙的做法。")]),s._v(" "),s._m(21),s._m(22),s._v(" "),n("p",[s._v("遍历对象，定义属性描述：")]),s._v(" "),s._m(23),n("p",[s._v("Dep代码：")]),s._v(" "),s._m(24),n("p",[s._v("中间层的Watcher:")]),s._v(" "),s._m(25),n("p",[s._v("生成响应式数据：")]),s._v(" "),s._m(26),n("p",[s._v("回到最开始的Vue页面，")]),s._v(" "),s._m(27),s._m(28),s._v(" "),s._m(29),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://medium.com/@mitchocail/observer-pattern-in-ruby-e80ac3c1dac7",target:"_blank",rel:"noopener noreferrer"}},[s._v("Observer Pattern in RUBY – Mitch – Medium"),n("OutboundLink")],1),s._v(" — — 发布/订阅")]),s._v(" "),n("li",[n("a",{attrs:{href:"http://ruby-doc.org/stdlib-2.5.3/libdoc/observer/rdoc/Observable.html#method-i-add_observer",target:"_blank",rel:"noopener noreferrer"}},[s._v("Module: Observable (Ruby 2.5.3)"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://www.404forest.com/2017/06/28/modern-web-development-tech-analysis-data-reactivity-system/",target:"_blank",rel:"noopener noreferrer"}},[s._v("现代前端科技解析 —— 数据响应式系统 (Data Reactivity System) - 404Forest"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://gist.github.com/staltz/868e7e9bc2a7b8c1f754",target:"_blank",rel:"noopener noreferrer"}},[s._v("The introduction to Reactive Programming you’ve been missing · GitHub"),n("OutboundLink")],1)])])])},a,!1,null,null,null);r.options.__file="reactivity.md";t.default=r.exports}}]);